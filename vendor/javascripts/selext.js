// Generated by CoffeeScript 1.7.1
(function() {
  var $;

  $ = jQuery;

  $.fn.extend({
    selext: function(options) {
      var settings;
      settings = {
        init: function() {
          return {};
        },
        parentClass: "selext-parent",
        selectClass: "selext",
        optionClass: "option",
        isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
      };
      settings = $.extend(settings, options);
      return this.each(function() {
        var $background, $select, $selext, carot, currentOption, showOptions;
        $select = $(this);
        if (settings.isMobile) {
          $select.css({
            opacity: 0,
            position: "absolute"
          });
        } else {
          $select.css({
            display: "none"
          });
        }
        options = [];
        currentOption = $select.find("option:selected").text();
        carot = "";
        if (!($select.find("option").length <= 1)) {
          carot = "<span class='arr'>&#x25BE;</span>";
          $select.find("option").each(function() {
            var $option;
            $option = $(this);
            return options.push("<li class=\"" + settings.optionClass + "\" data-value=\"" + ($option.val()) + "\">" + ($option.text()) + "</li>");
          });
        }
        if (options.length > 1) {
          $selext = $('<button/>', {
            "class": "custom-select closed " + settings.parentClass,
            type: "button",
            html: "" + carot + "<div class='current'>" + currentOption + "</div><ul class=\"" + settings.selectClass + "\">" + (options.join('')) + "</ul>"
          });
          $background = $(".selext-overlay");
          if ($background.length === 0) {
            $background = $("<div/>", {
              "class": "selext-overlay"
            }).appendTo("body");
          }
          $background.on("click", function(event) {
            $background.fadeOut("fast");
            return $selext.removeClass("open").addClass("closed");
          });
          $selext.on("focusout", function(event) {
            $background.fadeOut("fast");
            return $selext.removeClass("open").addClass("closed");
          });
          if (!settings.isMobile) {
            showOptions = function(event) {
              var states;
              $selext.css("z-index", 102);
              event.preventDefault();
              if ($selext.find("li").length > 1) {
                states = ["closed", "open"];
                if ($selext.hasClass("open")) {
                  states = ["open", "closed"];
                  $background.fadeOut("fast");
                } else {
                  $background.fadeIn("fast");
                }
                return $selext.removeClass(states[0]).addClass(states[1]);
              }
            };
            if (/Safari/i.test(navigator.userAgent)) {
              $selext.on("click", showOptions);
            } else {
              $selext.on("focusin", showOptions);
            }
          } else {
            $selext.on("click", function(event) {
              return $select.focus();
            });
          }
          $selext.find("li").on("click", function(event) {
            var $li, value;
            event.stopPropagation();
            $li = $(event.currentTarget);
            value = $li.attr("data-value");
            $select.find("option:selected").removeAttr("selected");
            return $select.find("option").each(function() {
              var $option;
              $option = $(this);
              if ($option.val() === value) {
                $option.attr("selected", "selected");
                $select.val($option.val());
                $select.val($option.val());
                $option.trigger("click");
                return $select.trigger("change");
              }
            });
          });
          $select.on("change", function(event) {
            var $li, value;
            value = $select.val();
            $li = $selext.find("li[data-value='" + value + "']");
            $selext.find(".current").text($li.text());
            return $selext.trigger("blur");
          });
        } else {
          $selext = $('<div/>', {
            "class": "custom-select closed " + settings.parentClass + " empty",
            html: "" + carot + "<div class='current'>" + currentOption + "</div>"
          });
        }
        $select.after($selext);
        return settings.init();
      });
    }
  });

}).call(this);
